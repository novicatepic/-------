# Детаљне информације о пројекту
Овај репозиторијум демонстрира повезивање U-Blox LEA-6S GPS Click уређаја на De1-SoC плочу и приказује једноставну апликацију за ишчитавање података.

Циљ приложеног садржаја је да омогући додатне информације о:
1. Повезивању *GPS Click* компоненте кориштењем *UART* интерфејса на *De1-SoC* плочу
2. Кориштењу *gpsd* алата за рад са *GPS* подацима
3. Подешавању *Buildroot* окружења тако да се омогући детектовање примљених података
4. Ишчитавању релевантних информација добијених од *GPS* уређаја

## Предуслови за израду пројекта

За успјешно извођење демонстрираног пројекта неопходно је сљедеће:
- развојна плова *De1-SoC* са припадајућим напајањем и каблом за повезивање рачунара са UART интерфејсом на плочи
- припремљен [*toolchain*](https://github.com/etf-unibl/urs-2024/blob/main/lab-01/lab-01.md) за кроскомпајлирање софтвера за циљну платформу
- припремљено [*Buildroot*](https://github.com/etf-unibl/urs-2024/blob/main/lab-08/lab-08.md) окружење 
- *SD* картица
- *Ethernet* мрежни интерфејс на развојној платформи и мрежни кабл за повезивање са плочом
- *GPS Click* плоча
- Антена
- 4 кабла за повезивање релевантних пинова *GPS Click* плоче и *De1-SoC* плоче

## Информације о *GPS Click* плочи

За више информација о *GPS Click* плочи неопходно је посјетити сљедећи линк [GPS Click](https://www.mikroe.com/gps-click).

Да би се детаљније упознали са компонентом неопходно је прочитати  [*datasheet*](https://download.mikroe.com/documents/datasheets/LEA-6S_datasheet.pdf).

## Повезивање *GPS Click* компоненте на *De1-SoC* плочу

На слици испод је приказан начин повезивања *GPS Click* компоненте на *De1-SoC* плочу.



Као што се може видјети са слике, спојени су уземљење и напајање (3.3V), те је TX пин *GPS Click* плоче спојен на *RX* пин *De1-SoC* плоче, као и *RX* пин *GPS Click* плоче на *TX* пин *De1-SoC* плоче.

Антена је такође спојена на *GPS Click*.

*Ethernet* мрежни кабл је искориштен да би се употребом *SCP* протокола могли копирате фајлови на циљну платформу.

На крају, искориштен је и кабл за повезивање лаптопа са *UART* интерфејсом на *De1-SoC* плочи.


## Прилагођавање конфигурације SPL-а и U-Boot окружења

Конфигурацију *SPL-а* вршимо примјеном *patch* фајла подешавањем опције *Bootloaders -> U-Boot -> Custom U-Boot patches* у конфигурацији *Buildroot-а*, гдје постављамо путању у односу на на *board* фолдер, у овом случају на *board/terasic/de1soc_cyclone5/patches/de1-soc-handoff.patch*.

Такође, неопходно је измијенити садржај *boot-env.txt* фајла у складу са приложеним фајлом на овом репозиторијуму.

## Подешавање *Buildroot* окружења употребом *menuconfig-а* и модификавија *rootfs overlay-а*

Да би се омогућио *gpsd* алат, неопходно је у коријеном фолдеру *Buildroot* покренути команду

```
make menuconfig
```

Након тога, неопходно је изабрати сљедећу опцију:

*Target Packages -> Hardware Handling -> gpsd*

Сљедећи корак је да се изабере */dev/ttyS1* у оквиру опције *Where to look for GPSes*, те да се укључе *client debugging support* и *profilling support*, као и протоколи приказани на слици.

Слика

Да би се детаљније упознали са кориштеним протоколима за *GPS Click*, неопходно је посјетити секцију *1.10 Protocols and interfaces* у [*datasheet-у*](https://download.mikroe.com/documents/datasheets/LEA-6S_datasheet.pdf).

Протоколи који су укључени на слици а не налазе се у *datasheet-у* су укључени аутоматски након укључивања неких од тражених протокола.

Коначно, неопходно је командом *Save* сачувати измјене и напустити *menuconfig*.

Да би се модификовао *rootfs overlay*, неопходно је унутар постојеће *rootfs overlay* инфраструктуре која је референцирана у [*лаборатијској вјежби број 8*](https://github.com/etf-unibl/urs-2024/blob/main/lab-08/lab-08.md) додати фајл унутар */etc/default* чији је назив *gpsd*.

Разлог за модификацију овог фајла јесте чињеница да он није аутоматски креиран на циљној платформи, а с обзиром да је постојао на развојном платформи закључак је био да га је неопходно било накнадно додати.

Садржај фајла треба да буде:

```
DEVICES="/dev/ttyS1"
GPSD_OPTIONS=""
USBAUTO="true"
```

На крају, неопходно је покренути сљедеће команде како би се примијениле све измјене:

```
make clean
make
```

Задњи корак јесте актуелизовање садржаја *SD* картице употребом *dd* алатке, те је због тога неопходно прећи у *output/images* директоријум и извршити сљедећу команду:

```
sudo dd if=sdcard.img of=/dev/sdb bs=1M
```

> [!CAUTION]
> Обратите посебну пажњу на то да изаберете исправан уређај, јер слично име може да има главни хард диск рачунара на којем радите. Поменута команда може да проузрокује брисање комплетног фајл система рачунара на којем радите ако изаберете погрешан уређај.

Након актуелизовања садржаја *SD* картице, унутар *FAT32* партиције на *SD* картици неопходно је копирати фајл *socfpga.rbf*.
